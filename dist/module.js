define(["@grafana/data","lodash","@grafana/runtime","react","@grafana/ui"],((e,t,r,a,n)=>(()=>{var o={6539:(e,t,r)=>{var a=r(7400).Symbol;e.exports=a},9349:e=>{e.exports=function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}},8213:(e,t,r)=>{var a=r(4701),n=r(2900),o=r(9785),s=r(3854),l=r(2383),i=r(8519),c=Object.prototype.hasOwnProperty;e.exports=function(e,t){var r=o(e),u=!r&&n(e),f=!r&&!u&&s(e),p=!r&&!u&&!f&&i(e),m=r||u||f||p,g=m?a(e.length,String):[],h=g.length;for(var d in e)!t&&!c.call(e,d)||m&&("length"==d||f&&("offset"==d||"parent"==d)||p&&("buffer"==d||"byteLength"==d||"byteOffset"==d)||l(d,h))||g.push(d);return g}},9736:(e,t,r)=>{var a=r(6539),n=r(4840),o=r(1258),s=a?a.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":s&&s in Object(e)?n(e):o(e)}},5829:(e,t,r)=>{var a=r(9736),n=r(2360);e.exports=function(e){return n(e)&&"[object Arguments]"==a(e)}},6729:(e,t,r)=>{var a=r(8338),n=r(9678),o=r(1611),s=r(6532),l=/^\[object .+?Constructor\]$/,i=Function.prototype,c=Object.prototype,u=i.toString,f=c.hasOwnProperty,p=RegExp("^"+u.call(f).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!o(e)||n(e))&&(a(e)?p:l).test(s(e))}},6972:(e,t,r)=>{var a=r(9736),n=r(4194),o=r(2360),s={};s["[object Float32Array]"]=s["[object Float64Array]"]=s["[object Int8Array]"]=s["[object Int16Array]"]=s["[object Int32Array]"]=s["[object Uint8Array]"]=s["[object Uint8ClampedArray]"]=s["[object Uint16Array]"]=s["[object Uint32Array]"]=!0,s["[object Arguments]"]=s["[object Array]"]=s["[object ArrayBuffer]"]=s["[object Boolean]"]=s["[object DataView]"]=s["[object Date]"]=s["[object Error]"]=s["[object Function]"]=s["[object Map]"]=s["[object Number]"]=s["[object Object]"]=s["[object RegExp]"]=s["[object Set]"]=s["[object String]"]=s["[object WeakMap]"]=!1,e.exports=function(e){return o(e)&&n(e.length)&&!!s[a(e)]}},9464:(e,t,r)=>{var a=r(1611),n=r(6016),o=r(1586),s=Object.prototype.hasOwnProperty;e.exports=function(e){if(!a(e))return o(e);var t=n(e),r=[];for(var l in e)("constructor"!=l||!t&&s.call(e,l))&&r.push(l);return r}},1197:(e,t,r)=>{var a=r(1137),n=r(1871),o=r(3132);e.exports=function(e,t){return o(n(e,t,a),e+"")}},4459:(e,t,r)=>{var a=r(551),n=r(2630),o=r(1137),s=n?function(e,t){return n(e,"toString",{configurable:!0,enumerable:!1,value:a(t),writable:!0})}:o;e.exports=s},4701:e=>{e.exports=function(e,t){for(var r=-1,a=Array(e);++r<e;)a[r]=t(r);return a}},9334:e=>{e.exports=function(e){return function(t){return e(t)}}},4937:(e,t,r)=>{var a=r(7400)["__core-js_shared__"];e.exports=a},2630:(e,t,r)=>{var a=r(1822),n=function(){try{var e=a(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=n},9120:(e,t,r)=>{var a="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g;e.exports=a},1822:(e,t,r)=>{var a=r(6729),n=r(5371);e.exports=function(e,t){var r=n(e,t);return a(r)?r:void 0}},4840:(e,t,r)=>{var a=r(6539),n=Object.prototype,o=n.hasOwnProperty,s=n.toString,l=a?a.toStringTag:void 0;e.exports=function(e){var t=o.call(e,l),r=e[l];try{e[l]=void 0;var a=!0}catch(e){}var n=s.call(e);return a&&(t?e[l]=r:delete e[l]),n}},5371:e=>{e.exports=function(e,t){return null==e?void 0:e[t]}},2383:e=>{var t=/^(?:0|[1-9]\d*)$/;e.exports=function(e,r){var a=typeof e;return!!(r=null==r?9007199254740991:r)&&("number"==a||"symbol"!=a&&t.test(e))&&e>-1&&e%1==0&&e<r}},7535:(e,t,r)=>{var a=r(5638),n=r(68),o=r(2383),s=r(1611);e.exports=function(e,t,r){if(!s(r))return!1;var l=typeof t;return!!("number"==l?n(r)&&o(t,r.length):"string"==l&&t in r)&&a(r[t],e)}},9678:(e,t,r)=>{var a,n=r(4937),o=(a=/[^.]+$/.exec(n&&n.keys&&n.keys.IE_PROTO||""))?"Symbol(src)_1."+a:"";e.exports=function(e){return!!o&&o in e}},6016:e=>{var t=Object.prototype;e.exports=function(e){var r=e&&e.constructor;return e===("function"==typeof r&&r.prototype||t)}},1586:e=>{e.exports=function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}},8125:(e,t,r)=>{e=r.nmd(e);var a=r(9120),n=t&&!t.nodeType&&t,o=n&&e&&!e.nodeType&&e,s=o&&o.exports===n&&a.process,l=function(){try{return o&&o.require&&o.require("util").types||s&&s.binding&&s.binding("util")}catch(e){}}();e.exports=l},1258:e=>{var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},1871:(e,t,r)=>{var a=r(9349),n=Math.max;e.exports=function(e,t,r){return t=n(void 0===t?e.length-1:t,0),function(){for(var o=arguments,s=-1,l=n(o.length-t,0),i=Array(l);++s<l;)i[s]=o[t+s];s=-1;for(var c=Array(t+1);++s<t;)c[s]=o[s];return c[t]=r(i),a(e,this,c)}}},7400:(e,t,r)=>{var a=r(9120),n="object"==typeof self&&self&&self.Object===Object&&self,o=a||n||Function("return this")();e.exports=o},3132:(e,t,r)=>{var a=r(4459),n=r(9591)(a);e.exports=n},9591:e=>{var t=Date.now;e.exports=function(e){var r=0,a=0;return function(){var n=t(),o=16-(n-a);if(a=n,o>0){if(++r>=800)return arguments[0]}else r=0;return e.apply(void 0,arguments)}}},6532:e=>{var t=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return t.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},551:e=>{e.exports=function(e){return function(){return e}}},236:(e,t,r)=>{var a=r(1197),n=r(5638),o=r(7535),s=r(3893),l=Object.prototype,i=l.hasOwnProperty,c=a((function(e,t){e=Object(e);var r=-1,a=t.length,c=a>2?t[2]:void 0;for(c&&o(t[0],t[1],c)&&(a=1);++r<a;)for(var u=t[r],f=s(u),p=-1,m=f.length;++p<m;){var g=f[p],h=e[g];(void 0===h||n(h,l[g])&&!i.call(e,g))&&(e[g]=u[g])}return e}));e.exports=c},5638:e=>{e.exports=function(e,t){return e===t||e!=e&&t!=t}},1137:e=>{e.exports=function(e){return e}},2900:(e,t,r)=>{var a=r(5829),n=r(2360),o=Object.prototype,s=o.hasOwnProperty,l=o.propertyIsEnumerable,i=a(function(){return arguments}())?a:function(e){return n(e)&&s.call(e,"callee")&&!l.call(e,"callee")};e.exports=i},9785:e=>{var t=Array.isArray;e.exports=t},68:(e,t,r)=>{var a=r(8338),n=r(4194);e.exports=function(e){return null!=e&&n(e.length)&&!a(e)}},3854:(e,t,r)=>{e=r.nmd(e);var a=r(7400),n=r(7714),o=t&&!t.nodeType&&t,s=o&&e&&!e.nodeType&&e,l=s&&s.exports===o?a.Buffer:void 0,i=(l?l.isBuffer:void 0)||n;e.exports=i},8338:(e,t,r)=>{var a=r(9736),n=r(1611);e.exports=function(e){if(!n(e))return!1;var t=a(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},4194:e=>{e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},1611:e=>{e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},2360:e=>{e.exports=function(e){return null!=e&&"object"==typeof e}},8519:(e,t,r)=>{var a=r(6972),n=r(9334),o=r(8125),s=o&&o.isTypedArray,l=s?n(s):a;e.exports=l},3893:(e,t,r)=>{var a=r(8213),n=r(9464),o=r(68);e.exports=function(e){return o(e)?a(e,!0):n(e)}},7714:e=>{e.exports=function(){return!1}},3305:t=>{"use strict";t.exports=e},3545:e=>{"use strict";e.exports=r},7388:e=>{"use strict";e.exports=n},5980:e=>{"use strict";e.exports=t},2650:e=>{"use strict";e.exports=a}},s={};function l(e){var t=s[e];if(void 0!==t)return t.exports;var r=s[e]={id:e,loaded:!1,exports:{}};return o[e](r,r.exports,l),r.loaded=!0,r.exports}l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},l.d=(e,t)=>{for(var r in t)l.o(t,r)&&!l.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},l.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.nmd=e=>(e.paths=[],e.children||(e.children=[]),e);var i={};return(()=>{"use strict";l.r(i),l.d(i,{plugin:()=>C});var e=l(3305),t=l(5980),r=l.n(t),a=l(3545);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class o{constructor(e){return n(this,"maxCache",void 0),n(this,"cache",[]),n(this,"set",((e,t,r)=>{if(!this.recordExists(e,t)){if(this.cache.length>=this.maxCache){const e=this.cache.keys().next().value;delete this.cache[e]}this.cache.push({url:e,params:{start:new Date(t.range.from).getTime(),end:new Date(t.range.to).getTime(),targets:t.targets},result:r})}})),n(this,"get",((e,t)=>{let r=null;const a=this.cache.find((a=>{let n=new Date(t.range.from).getTime(),o=new Date(t.range.to).getTime();return a.url===e&&JSON.stringify(a.params.targets)===JSON.stringify(t.targets)?n>=a.params.start&&o<=a.params.end||(n<a.params.start&&o<a.params.end?(r=[n,a.params.start],!0):n>a.params.end?null:n>=a.params.start&&o>a.params.end?(r=[a.params.end,o],!0):null):null}));return r?[a,r]:a?[a,null]:null})),n(this,"recordExists",((e,t)=>!!this.get(e,t))),this.maxCache=e,o.instance?(o.instance=this,this):o.instance}}function s(e,t,r,a,n,o,s){try{var l=e[o](s),i=l.value}catch(e){return void r(e)}l.done?t(i):Promise.resolve(i).then(a,n)}function c(e){return function(){var t=this,r=arguments;return new Promise((function(a,n){var o=e.apply(t,r);function l(e){s(o,a,n,l,i,"next",e)}function i(e){s(o,a,n,l,i,"throw",e)}l(void 0)}))}}function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}n(o,"instance",void 0);class f extends e.DataSourceApi{buildQueryParameters(e){let t=r().map(e.targets,(e=>({target:(0,a.getTemplateSrv)().replace(e.target)||null,container:(0,a.getTemplateSrv)().replace(e.container)||null,schema:(0,a.getTemplateSrv)().replace(e.schema)||null,query_type:e.queryType||"metrics",filters:(0,a.getTemplateSrv)().replace(e.filters)||null,format:(0,a.getTemplateSrv)().replace(e.format)||"time_series",analysis_module:(0,a.getTemplateSrv)().replace(e.analysisModule)||null,extra_params:(0,a.getTemplateSrv)().replace(e.extraParams)||null,refId:e.refId,hide:e.hide})));return e.targets=t,e}doSosRequest(e){return c((function*(){return(0,a.getBackendSrv)().datasourceRequest(e)}))()}mapMetricToTextValue(e){return{data:r().map(e.data,((e,t)=>e&&e.text&&e.value?{text:e.text,value:e.value}:{text:e,value:t}))}}query(e){var t=this;return c((function*(){const r=t.buildQueryParameters(e),a={method:"POST",url:t.url+"/query",data:r,headers:{"Content-Type":"application/json"}};let n=t.dsosCache.get(t.url,r);if(null!==n){if(null!==n[1]){const e=r.range.from,o=r.range.to;let s=yield t.partialDSosQuery(a,n[1]),l=0;if(s.data.length===n[0].result.data.length)for(;l<n[0].result.data.length;)s.data[l].datapoints=s.data[l].datapoints.concat(n[0].result.data[l].datapoints),l+=1;return s.config.data.range.from=e,s.config.data.range.to=o,new Promise((e=>e(s)))}return new Promise((e=>e(n[0].result)))}return t.doSosRequest(a).then((o=c((function*(e){if(!e.ok)throw e;return t.dsosCache.set(t.url,r,e),e})),function(e){return o.apply(this,arguments)}));var o}))()}partialDSosQuery(e,t){var r=this;return c((function*(){e.data.range.from=new Date(t[0]),e.data.range.to=new Date(t[1]);let a={method:"POST",url:r.url+"/query",data:e.data,headers:{"Content-Type":"application/json"}};return r.doSosRequest(a).then((n=c((function*(e){if(!e.ok)throw e;return e})),function(e){return n.apply(this,arguments)}));var n}))()}testDatasource(){var e=this;return c((function*(){const t={url:e.url+"/",method:"GET",headers:{"Content-Type":"application/json"}};return e.doSosRequest(t).then((e=>200===e.status?{status:"success",message:"Datasource connected",title:"Success"}:{status:"error",message:"Enable to make connection to SOS database",title:"Failed"})).catch((e=>({status:"error",message:e.message})))}))()}constructor(e){var t;super(e),u(this,"type",void 0),u(this,"name",void 0),u(this,"url",void 0),u(this,"dsosCache",void 0),this.type=e.type,this.url=r().map(null===(t=e.url)||void 0===t?void 0:t.split(","),(e=>e.trim())),this.name=e.name,this.dsosCache=new o(10)}}var p=l(2650),m=l.n(p),g=l(7388);const{Select:h}=g.LegacyForms,d=[{label:"SOS",value:"sos"},{label:"Distributed SOS",value:"dsos"}];class y extends p.PureComponent{render(){const{options:t,onOptionsChange:r}=this.props;return m().createElement(m().Fragment,null,m().createElement(g.DataSourceHttpSettings,{defaultUrl:"http://localhost:8080/grafana/",dataSourceConfig:t,onChange:r}),m().createElement("h3",{className:"page-heading"},"Sos Details"),m().createElement("div",{className:"gf-form-group"},m().createElement("div",{className:"gf-form-inline"},m().createElement("div",{className:"gf-form"},m().createElement(g.InlineFormLabel,{className:"width-10",tooltip:"The POST method is used by default"},"Sos Version"),m().createElement(h,{className:"width-10",value:d.find((e=>e.value===t.jsonData.sosVersion)),options:d,defaultValue:t.jsonData.sosVersion,onChange:(0,e.onUpdateDatasourceJsonDataOptionSelect)(this.props,"sosVersion")})))))}constructor(e){super(e)}}var v=l(236),b=l.n(v);const x={frequency:1};function j(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function O(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},a=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),a.forEach((function(t){j(e,t,r[t])}))}return e}function w(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);r.push.apply(r,a)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const{FormField:S}=g.LegacyForms;class E extends p.PureComponent{render(){const e=b()(this.props.query,x),{analysisModule:t,container:r,extraParams:a,filters:n,format:o,queryType:s,schema:l,target:i}=e;return m().createElement(m().Fragment,null,m().createElement("div",{className:"gf-form-group"},m().createElement("div",{className:"gf-form-inline"},m().createElement("div",{className:"gf-form"},m().createElement("label",{className:"gf-form-label query-keyword width-8"},"Query Type"),m().createElement("select",{value:s,defaultValue:"metrics",className:"gf-form-input width-12",onChange:this.onQueryTypeChange},m().createElement("option",{selected:!0},"metrics"),m().createElement("option",null,"analysis"))),"analysis"===s&&m().createElement(S,{labelWidth:8,value:t,label:"Analysis",tooltip:"Name of analysis module",onChange:this.onAnalysisChange,className:"gf-form-label query-keyword"}),m().createElement("div",{className:"gf-form"},m().createElement("label",{className:"gf-form-label query-keyword width-8"},"Query Format"),m().createElement("select",{value:o,className:"gf-form-input width-12",placeholder:"format",onChange:this.onFormatChange},m().createElement("option",null,"time_series"),m().createElement("option",null,"table"),m().createElement("option",null,"heatmap"))),m().createElement("div",{className:"gf-form gf-form--grow"},m().createElement("div",{className:"gf-form-label gf-form-label--grow"}))),m().createElement("div",{className:"gf-form-inline"},m().createElement("div",{className:"gf-form"},m().createElement(S,{labelWidth:8,value:r,label:"Container",tooltip:"Name of SOS Container to query",onChange:this.onContainerChange,className:"gf-form-label query-keyword"})),m().createElement("div",{className:"gf-form"},m().createElement(S,{labelWidth:8,value:l,label:"Schema",tooltip:"Name of schema to query",onChange:this.onSchemaChange,className:"gf-form-label query-keyword"})),m().createElement("div",{className:"gf-form gf-form--grow"},m().createElement("div",{className:"gf-form-label gf-form-label--grow"}))),m().createElement("div",{className:"gf-form-inline"},m().createElement("div",{className:"gf-form"},m().createElement(S,{labelWidth:8,value:i,onChange:this.onTargetChange,label:"Metric",tooltip:"Metric to query",className:"gf-form-label query-keyword"}),"analysis"===s&&m().createElement(S,{labelWidth:9,value:a,onChange:this.onExtraChange,label:"Extra Parameters",tooltip:"Additional keyword to specify for analysis modules",className:"gf-form-label query-keyword"})),m().createElement("div",{className:"gf-form gf-form--grow"},m().createElement("div",{className:"gf-form-label gf-form-label--grow"}))),m().createElement("div",{className:"gf-form-inline"},m().createElement("div",{className:"gf-form"},m().createElement(S,{labelWidth:8,value:n,onChange:this.onFilterChange,label:"Filters",tooltip:"Adds filters to 'where' clause of sql query e.g. '(component_id==10000)'",className:"gf-form-label query-keyword"})),m().createElement("div",{className:"gf-form gf-form--grow"},m().createElement("div",{className:"gf-form-label gf-form-label--grow"})))))}constructor(e){super(e),j(this,"onAnalysisChange",(e=>{const{onChange:t,query:r}=this.props;t(w(O({},r),{analysisModule:e.target.value}))})),j(this,"onContainerChange",(e=>{const{onChange:t,query:r}=this.props;t(w(O({},r),{container:e.target.value}))})),j(this,"onExtraChange",(e=>{const{onChange:t,query:r}=this.props;t(w(O({},r),{extraParams:e.target.value}))})),j(this,"onFilterChange",(e=>{const{onChange:t,query:r}=this.props;t(w(O({},r),{filters:e.target.value}))})),j(this,"onFormatChange",(e=>{const{onChange:t,query:r}=this.props;t(w(O({},r),{format:e.target.value}))})),j(this,"onQueryTypeChange",(e=>{const{onChange:t,query:r}=this.props;t(w(O({},r),{queryType:e.target.value}))})),j(this,"onSchemaChange",(e=>{const{onChange:t,query:r}=this.props;t(w(O({},r),{schema:e.target.value}))})),j(this,"onTargetChange",(e=>{const{onChange:t,query:r}=this.props;t(w(O({},r),{target:e.target.value}))})),j(this,"getFilterState",(()=>this.state.filters)),this.state={filters:[]}}}const C=new e.DataSourcePlugin(f).setConfigEditor(y).setQueryEditor(E)})(),i})()));
//# sourceMappingURL=module.js.map